# cyberimmune-systems-autonomous-delivery-drone-with-kos

Cyberimmune autonomous delivery drone prototype

## Структура полетного контроллера KOS

Полетный контроллер состоит из 6 модулей: autopilot_connector, credential_manager, navigation_system, periphery_controller, server_connector и flight_controller. Участникам соревнований предлагается вносить изменения в программный код модуля flight_controller. Взаимодействие с остальными модулями выполняется посредством IPC-сообщений; внесение изменений в эти модули не рекомендуется.

## IPC-сообщения

Папка shared содержит файлы с функциями-обертками, облегчающими отправку IPC-сообщений. Файлы соответствуют модулям, для которгго предназачены сообщения. Все функции-обертки возвращают цифровое знаечние: 1 в случае успешной отправки и получении ответа, 0 -- в ином случае.

1. ipc_messages_initialization: содержит универсальное сообщение, воспринимаемое модулями autopilot_connector, credential_manager, navigation_system, periphery_controller и server_connector
    1. int waitForInit(const char\* connection, const char\* receiverEntity): статус инициализации модуля. Поскольку сообщение универсально, необходимо указать модуль и соединение, по которому будет отправлено сообщение

2. ipc_messages_autopilot_connector: содержит сообщения для модуля autopilot_connector, выполняющего взаимодействие с прошивкой автопилота через UART-порт
    1. int waitForArmRequest(): переводит UART-порт в режим "слушания" и ожидает получение от автопилота запроса на arm
    2. int permitArm(): передает в автопилот сообщение, разрешающее arm. Данная команда не заставляет автопилот произвести arm
    3. int forbidArm(): передает в автопилот сообщение, запрещающее arm. Данная команда не гарантирует, что arm в автопилоте не будет произведен
    4. int pauseFlight(): передает в автопилот запрос на приостановку полета. При корректной работе автопилота это вызовет прерывание текущей миссии и выполнение посадки в текущем местоположении дрона
    5. int forbidArm(): передает в автоплиот запрос на возобновление полета. При корректной работе автопилота это приведет к возобновлению приостановленной ранее миссии
    6. int changeSpeed(int32_t speed): передает в автоплиот запрос на изменение скорости. Скорость указывается в м/с
    7. int changeAltitude(int32_t altitude): передает в автоплиот запрос на изменение высоты для всех точек миссии. Высота указывается в см относительно высоты дома
    8. int changeWaypoint(int32_t latitude, int32_t longitude, int32_t altitude): передает в автопилот запрос на изменение текущей точки мисси на переданную. Высота указывается в см относительно высоты дома; щирота и долгота - в градусах \* 10^7

3. ipc_messages_credential_manager: содержит сообщения для модуля credential_manager, выполняющего проверку аутентичности подписей сообщений от ОРВД
    1. int signMessage(char\* message, char\* signature): производит вычисление подписи для сообщения message и записывает ее в signature
    2. int checkSignature(char\* message, uint8_t &authenticity): производит проверку аутентичности сообщения. На выход подается сообщение в формате "сообщение#подпись" (без кавычек), записывает в authenticity 1 в случае подтверждения аутентичности и 0 в ином случае

4. ipc_messages_navigation_system: содержит сообщения для модуля navigation_system, работающего с GPS и баромтером, подключенным к RaspberryPi
    1. int getCoords(int32_t &latitude, int32_t &longitude, int32_t &altitude): записывает в переданные переменные текущие координаты дрона. Значения долготы и широты - в градусах \* 10^7, высоты - в м \* 10^7
    2. int getDop(float& dop): записывает в переданную переменную значение DOP (снижение точности), полученное от GPS

5. ipc_messages_periphery_controller: содержит сообщения для модуля periphery_controller, выполняющего взаимодействие с GPIO
    1. int enableBuzzer(): включает баззер. Звук будет автоматически отключен через 2 секунды
    2. int setKillSwitch(uint8_t enable): регулирует подачу питания на двигатели. При enbale=1 использование моторов возможно, при 0 - нет
    3. int setCargoLock(uint8_t enable): регулирует подачу питания на двигатель сброса груза. При enbale=1 сброс груза возможен, при 0 - нет

6. ipc_messages_server_connector: содержит сообщения для модуля server_connector, выполняющего общение я сервером ОРВД
    1. int sendRequest(char\* query, char\* response): отправляет на сервер запрос, переданный в request, и записывает ответ в response. В response возвращается только значимое содержание полученного ответа
